<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Today | shesaiditwasmyfault</title>
    
    <!-- 默认图标，会被下方 JS 覆盖为圆形 -->
    <link rel="icon" href="./bg.jpg" type="image/jpeg">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-heading: "Playfair Display", "Songti SC", serif;
            --font-body: "Lora", "Songti SC", serif;
            --text-color: #ffffff;
            --card-bg: rgba(0, 0, 0, 0.45);
            --player-size: 60px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            background-color: #1a1a1a;
        }

        /* 背景层 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('./bg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            will-change: transform;
            filter: brightness(0.8);
        }

        .container {
            width: 90%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 0;
        }

        .essay-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 30px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: padding 0.3s ease;
        }

        h1 {
            font-family: var(--font-heading);
            font-weight: normal;
            font-size: clamp(1.5rem, 5vw, 2.2rem);
            margin-bottom: 30px;
            text-align: center;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .essay-content {
            font-family: var(--font-body);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: justify;
            text-shadow: 0 1px 2px rgba(0,0,0,0.6);
        }

        .essay-content p {
            margin-bottom: 20px;
        }

        /* 音乐播放器 */
        .music-disc {
            position: fixed;
            bottom: max(30px, calc(20px + env(safe-area-inset-bottom)));
            right: 20px;
            width: var(--player-size);
            height: var(--player-size);
            border-radius: 50%;
            cursor: pointer;
            z-index: 100;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 15px rgba(0,0,0,0.4);
            background: #000;
            animation: rotatePlayer 10s linear infinite;
            animation-play-state: paused;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.2s;
        }

        .music-disc:active {
            transform: scale(0.95);
        }

        .music-disc img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
        }

        .music-disc.playing {
            animation-play-state: running;
            border-color: #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
        }

        @keyframes rotatePlayer {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (min-width: 768px) {
            .container {
                width: 85%;
                padding: 60px 20px;
            }
            .essay-card {
                padding: 50px 60px;
                border-radius: 16px;
            }
            h1 {
                margin-bottom: 40px;
                letter-spacing: 4px;
            }
            .essay-content {
                font-size: 1.15rem;
            }
            .music-disc {
                bottom: 30px;
                right: 30px;
            }
        }
    </style>
</head>
<body>

    <div class="music-disc" id="musicDisc" title="点击播放/暂停">
        <img src="./bg.jpg" alt="Music Cover">
        <audio id="bgm" loop>
            <source src="./music.mp3" type="audio/mpeg">
        </audio>
    </div>

    <div class="container">
        <article class="essay-card">
            <h1>She said it was my fault</h1>
            
            <div class="essay-content">
                <p>
                    If this is the perfect distance between us, then perhaps I shouldn't take another step forward.
                </p>
                <p>
                    Tonight I scrolled through old chat logs and suddenly saw that line: “It's my fault.”
                    Back then I was desperate to defend myself, pushing all blame away as if afraid to be tainted by even the slightest mistake.
                    But now, in quiet reflection, I realize it might have been a form of camouflage. We're so terrified of being blamed
                    that we end conversations with apologies or mask our guilt with anger.
                </p>
                <p>
                    I want to create a place like this—not for anyone else to see, but simply to find a quiet corner in this noisy internet where I can admit: Yes, that day, it really was my fault.
                    I didn't control my emotions. I didn't understand your unspoken meaning. I was too caught up in right and wrong,
                    and forgot that embracing each other matters more than arguing points.
                </p>
                <p>
                    Xue Zhiqian sings, “Those who loved fiercely shouldn't dwell on the past,” yet we not only dwell—we nitpick over every detail.
                    The flickering light and shadow in the background resemble those blurred fragments in my memory.
                    Writing these words isn't just recording—it's also a way to make peace with myself.
                </p>
                <p>
                    I've thought about it for a long time. If breaking up is too complicated, then let's just leave it at that.
                </p>
                <p>
                    The world is vast, and whether it's bugs in code or bugs in life, the first step to fixing them
                    is always that honest admission: This is my fault.
                </p>
            </div>
        </article>
    </div>

    <script>
        const musicDisc = document.getElementById('musicDisc');
        const bgm = document.getElementById('bgm');

        function tryAutoPlay() {
            const playPromise = bgm.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    musicDisc.classList.add('playing');
                }).catch(error => {
                    console.log("Auto-play prevented by browser policy.");
                });
            }
        }

        /**
         * 自动化核心：
         * 1. 读取 CSS 中的背景图 URL
         * 2. 在内存中创建一个画布 (Canvas)
         * 3. 将图片画在画布上，并裁剪成圆形
         * 4. 导出为图标数据并设置给浏览器
         */
        function setCircularFavicon() {
            // 1. 获取背景图 URL
            const style = window.getComputedStyle(document.body, '::before');
            const bgImage = style.getPropertyValue('background-image');
            
            if (bgImage && bgImage !== 'none' && bgImage.startsWith('url')) {
                // 提取纯净 URL
                const url = bgImage.slice(4, -1).replace(/["']/g, "");
                
                // 2. 加载图片进行处理
                const img = new Image();
                img.crossOrigin = "Anonymous"; // 允许处理本地或同源图片
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const size = 64; // 图标尺寸
                    canvas.width = size;
                    canvas.height = size;
                    const ctx = canvas.getContext('2d');
                    
                    // 3. 绘制圆形裁剪路径
                    ctx.beginPath();
                    ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2, true);
                    ctx.closePath();
                    ctx.clip(); // 之后画的内容只会在圆形内显示
                    
                    // 计算图片“居中裁剪 (Cover)”的参数
                    let sWidth = img.width;
                    let sHeight = img.height;
                    let sx = 0;
                    let sy = 0;
                    
                    // 保持比例填满正方形
                    if (sWidth > sHeight) {
                        sx = (sWidth - sHeight) / 2;
                        sWidth = sHeight;
                    } else {
                        sy = (sHeight - sWidth) / 2;
                        sHeight = sWidth;
                    }
                    
                    // 将图片画入圆形区域
                    ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, size, size);
                    
                    // 4. 设置为图标
                    const dataURL = canvas.toDataURL('image/png');
                    let link = document.querySelector("link[rel~='icon']");
                    if (!link) {
                        link = document.createElement('link');
                        link.rel = 'icon';
                        document.head.appendChild(link);
                    }
                    link.href = dataURL;
                    link.type = "image/png";
                };
                img.src = url;
            }
        }

        window.addEventListener('load', function() {
            tryAutoPlay();
            setCircularFavicon(); // 执行圆形图标设置
        });

        musicDisc.addEventListener('click', function() {
            if (bgm.paused) {
                bgm.play();
                this.classList.add('playing');
            } else {
                bgm.pause();
                this.classList.remove('playing');
            }
        });
    </script>
</body>
</html>
